<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faktura z XML</title>
    <style>
        body {
            background-color: #e0e0e0;
            font-family: Arial, sans-serif;
            font-size: 15px; 
        }

        #faktura-kontener {
            width: 960px;
            height: 1356px;
            background-image: url('fvat.png');
            background-repeat: no-repeat;
            position: relative;
            margin: 20px auto; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .pole {
            position: absolute;
        }

        #pole-numer { top: 210px; left: 285px; font-weight: bold; }
        #pole-miejsce-data { top: 230px; left: 700px; }
        
        #pole-termin-platnosci { top: 347px; left: 64px; }
        #pole-forma-platnosci { top: 347px; left: 289px; }
        #pole-data-dostawy { top: 347px; left: 615px; line-height: 1.5; }

        #pole-sprzedawca { top: 450px; left: 64px; line-height: 1.5; }
        #pole-nabywca { top: 450px; left: 522px; line-height: 1.5; }
        
        #pole-numer-konta { top: 630px; left: 197px; }
        
        #pole-lista-pozycji {
            top: 780px;
            left: 52px;
            width: 800px;
        }

        #pole-razem {
            top: 1150px;
            left: 770px;
            width: 122px;
            text-align: right;
            padding-right: 5px;
            font-weight: bold;
        } 

        .wiersz {
            position: relative;
            height: 35px; 
            line-height: 25px;
            font-size: 14px;
        }

        .wiersz .kol-lp { 
            position: absolute;
            left: 0px;
            width: 35px; 
            text-align: center;
        }

        .wiersz .kol-nazwa { 
            position: absolute;
            left: 35px;
            width: 290px; 
            text-align: left;
            padding-left: 5px;
        }

        .wiersz .kol-pkwiu { 
            position: absolute;
            left: 500px;
            width: 99px; 
            text-align: center;
        }

        .wiersz .kol-jm { 
            position: absolute;
            left: 585px;
            width: 58px; 
            text-align: center;
        }

        .wiersz .kol-ilosc { 
            position: absolute;
            left: 620px;
            width: 64px; 
            text-align: center;
        }

        .wiersz .kol-cena { 
            position: absolute;
            left: 620px;
            width: 116px;
            text-align: right;
            padding-right: 10px;
        }

        .wiersz .kol-wartosc { 
            position: absolute;
            left: 710px;
            width: 122px;
            text-align: right;
            padding-right: 10px;
        }
    </style>
</head>

<body>

    <div id="faktura-kontener">
        <div id="pole-numer" class="pole"></div>
        <div id="pole-miejsce-data" class="pole"></div>
        <div id="pole-termin-platnosci" class="pole"></div>
        <div id="pole-forma-platnosci" class="pole"></div>
        <div id="pole-data-dostawy" class="pole"></div>
        <div id="pole-numer-konta" class="pole"></div>
        <div id="pole-sprzedawca" class="pole"></div>
        <div id="pole-nabywca" class="pole"></div>
        
        <div id="pole-lista-pozycji" class="pole">
            </div>
        
        <div id="pole-razem" class="pole"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            
            fetch('dane.xml')
                .then(response => response.text())
                .then(xmlDataString => {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlDataString, "text/xml");
                    
                    if (xmlDoc.getElementsByTagName("parsererror").length) {
                        throw new Error("Błąd parsowania pliku XML. Sprawdź plik dane.xml.");
                    }

                    wypelnijFakture(xmlDoc);
                })
                .catch(error => {
                    console.error("Wystąpił błąd:", error);
                    alert("Wystąpił błąd podczas wczytywania lub przetwarzania faktury: " + error);
                });

        });

        function wypelnijFakture(xmlDoc) {

            function getText(tag) {
                const node = xmlDoc.querySelector(tag);
                return node ? node.textContent : '';
            }
            
            function getHtml(tag) {
                const node = xmlDoc.querySelector(tag);
                return node ? node.innerHTML : '';
            }

            document.getElementById('pole-numer').innerText = getText('numer');
            document.getElementById('pole-miejsce-data').innerText = getText('miejsce_data');
            document.getElementById('pole-termin-platnosci').innerText = getText('termin_platnosci');
            document.getElementById('pole-forma-platnosci').innerText = getText('forma_platnosci');
            document.getElementById('pole-data-dostawy').innerText = getText('data_dostawy');
            document.getElementById('pole-numer-konta').innerText = getText('numer_konta');
            
            const sprzedawcaNazwa = getText('sprzedawca nazwa');
            const sprzedawcaAdres = getHtml('sprzedawca adres');
            document.getElementById('pole-sprzedawca').innerHTML = `<strong>${sprzedawcaNazwa}</strong><br>${sprzedawcaAdres}`;
            
            const nabywcaNazwa = getText('nabywca nazwa');
            const nabywcaAdres = getHtml('nabywca adres');
            document.getElementById('pole-nabywca').innerHTML = `<strong>${nabywcaNazwa}</strong><br>${nabywcaAdres}`;

            const listaContainer = document.getElementById('pole-lista-pozycji');
            const pozycje = xmlDoc.querySelectorAll('pozycja');
            let sumaRazem = 0;

            pozycje.forEach(pozycja => {
                const nazwa = pozycja.querySelector('nazwa').textContent;
                const pkwiu = pozycja.querySelector('pkwiu').textContent;
                const jm = pozycja.querySelector('jm').textContent;
                const ilosc = parseFloat(pozycja.querySelector('ilosc').textContent);
                const cena_netto = parseFloat(pozycja.querySelector('cena_netto').textContent);

                const wartosc_netto = ilosc * cena_netto;
                sumaRazem += wartosc_netto;
                
                const wierszHTML = `
                    <div class="wiersz">
                        <div class="kol-nazwa">${nazwa}</div>
                        <div class="kol-pkwiu">${pkwiu}</div>
                        <div class="kol-jm">${jm}</div>
                        <div class="kol-ilosc">${ilosc}</div>
                        <div class="kol-cena">${cena_netto.toFixed(2)}</div>
                        <div class="kol-wartosc">${wartosc_netto.toFixed(2)}</div>
                    </div>
                `;
                
                listaContainer.innerHTML += wierszHTML;
            });

            document.getElementById('pole-razem').innerText = sumaRazem.toFixed(2);
        
        }
    </script>

</body>
</html>